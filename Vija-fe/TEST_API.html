<!DOCTYPE html>
<html>
<head>
    <title>Test API</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Test Vija API</h1>
    
    <h2>1. Test Backend</h2>
    <button onclick="testBackend()">Test Backend</button>
    <div id="backend-result"></div>

    <h2>2. Login</h2>
    <button onclick="testLogin()">Login (admin/admin123)</button>
    <div id="login-result"></div>

    <h2>3. Test Dashboard</h2>
    <button onclick="testDashboard()">Test Dashboard</button>
    <div id="dashboard-result"></div>

    <h2>4. Add Test Data</h2>
    <button onclick="addTestData()">Add QLKH Test Data</button>
    <div id="add-result"></div>

    <script>
        const API_URL = 'http://localhost:3000';

        function showResult(elementId, message, isError = false) {
            const el = document.getElementById(elementId);
            el.innerHTML = `<pre class="${isError ? 'error' : 'success'}">${message}</pre>`;
        }

        async function testBackend() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                showResult('backend-result', '✅ Backend OK:\n' + JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('backend-result', '❌ Backend Error:\n' + error.message, true);
            }
        }

        async function testLogin() {
            try {
                const response = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username: 'admin', password: 'admin123'})
                });
                const data = await response.json();
                
                if (data.token) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    localStorage.setItem('isAuthenticated', 'true');
                    showResult('login-result', '✅ Login OK:\n' + JSON.stringify(data, null, 2));
                } else {
                    showResult('login-result', '❌ Login Failed:\n' + JSON.stringify(data, null, 2), true);
                }
            } catch (error) {
                showResult('login-result', '❌ Login Error:\n' + error.message, true);
            }
        }

        async function testDashboard() {
            const token = localStorage.getItem('token');
            if (!token) {
                showResult('dashboard-result', '❌ No token. Please login first.', true);
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/dashboard`, {
                    headers: {'Authorization': `Bearer ${token}`}
                });
                const data = await response.json();
                
                if (Array.isArray(data)) {
                    showResult('dashboard-result', `✅ Dashboard OK (${data.length} rows):\n` + JSON.stringify(data, null, 2));
                } else {
                    showResult('dashboard-result', '❌ Dashboard Error:\n' + JSON.stringify(data, null, 2), true);
                }
            } catch (error) {
                showResult('dashboard-result', '❌ Dashboard Error:\n' + error.message, true);
            }
        }

        async function addTestData() {
            const token = localStorage.getItem('token');
            if (!token) {
                showResult('add-result', '❌ No token. Please login first.', true);
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/qlkh`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        po: 'PO001',
                        ma_bv: 'BV001',
                        so_luong: 100,
                        don_gia: 50000
                    })
                });
                const data = await response.json();
                showResult('add-result', '✅ Data Added:\n' + JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('add-result', '❌ Add Error:\n' + error.message, true);
            }
        }

        // Auto test on load
        window.onload = () => {
            console.log('Test page loaded. Click buttons to test API.');
        };
    </script>
</body>
</html>
